project:
  get:
    operationId: previewStatus
    tags:
      - preview
    summary: Preview status
    description: Returns the preview status of the respective resource.
    security:
      - {}
      - AuthCookie:
          - preview:read
    parameters:
      - $ref: "./parameters.yaml#/ownerParam"
      - $ref: "./parameters.yaml#/repoParam"
      - $ref: "./parameters.yaml#/refParam"
      - $ref: "./parameters.yaml#/pathParam"
    responses:
      '200':
        description: The preview status
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./schemas.yaml#/resourceInfo"
                - $ref: "./schemas.yaml#/previewInfo"
                - $ref: "./schemas.yaml#/resourceLinksInfo"
            examples:
              success:
                description: Success response of a preview document.
                value:
                  webPath: "/en/2021/blog"
                  resourcePath: "/en/2021/blog.md"
                  preview:
                    status: 200
                    url: "https://main--repo--owner.hlx.page/en/2021/blog"
                    lastModified: "2021-05-31T23:00:00Z"
                    contentBusId: "h3-theblog-123ab123ab12ab123a12b3a/preview/en/2021/blog.md"
                    sourceLocation: "onedrive:/drives/b!DyVXacYnlkm_17hZL307Me9vzRzaKwZCpVMBYbPOKaVT_gD5WmlHRbC-PCpiwGPx/items/012VWERI4JFIU56LICZNBZA4MYHF6Z4AKJ"
                    sourceLastModified: "2021-05-29T21:00:00Z"
                    permissions:
                      - read
                  links:
                    status: "https://admin.hlx.page/status/adobe/blog/main/blog"
                    preview: "https://admin.hlx.page/preview/adobe/blog/main/blog"
                    live: "https://admin.hlx.page/live/adobe/blog/main/blog"
                    code: "https://admin.hlx.page/code/adobe/blog/main/blog"
      '400':
        $ref: "./responses.yaml#/400"
      '401':
        $ref: "./responses.yaml#/401"
      '403':
        $ref: "./responses.yaml#/403"
      '404':
        $ref: "./responses.yaml#/404"

  post:
    operationId: updatePreview
    tags:
      - preview
    summary: Update preview
    description: >
      Updates the preview resource by fetching the latest content from the content providers
      (e.g. content-proxy) and storing it in the `preview` content-bus partition.
    security:
      - {}
      - AuthCookie:
          - edit:read
          - preview:read
          - preview:write
    parameters:
      - $ref: "./parameters.yaml#/ownerParam"
      - $ref: "./parameters.yaml#/repoParam"
      - $ref: "./parameters.yaml#/refParam"
      - $ref: "./parameters.yaml#/pathParam"
      - $ref: "./parameters.yaml#/forceUpdateRedirectsParam"
      - $ref: "./parameters.yaml#/word2mdVersionParam"
      - $ref: "./parameters.yaml#/gdocs2mdVersionParam"
      - $ref: "./parameters.yaml#/html2mdVersionParam"
    responses:
      '200':
        description: Preview resource updated.
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./schemas.yaml#/resourceInfo"
                - $ref: "./schemas.yaml#/previewInfo"
                - $ref: "./schemas.yaml#/resourceLinksInfo"
            examples:
              success:
                description: Success response.
                value:
                  webPath: "/en/2021/blog"
                  resourcePath: "/en/2021/blog.md"
                  preview:
                    status: 200
                    url: "https://main--repo--owner.hlx.page/en/2021/blog"
                    lastModified: "2021-05-31T23:00:00Z"
                    contentBusId: "h3-theblog-123ab123ab12ab123a12b3a/preview/en/2021/blog.md"
                    sourceLocation: "onedrive:/drives/b!DyVXacYnlkm_17hZL307Me9vzRzaKwZCpVMBYbPOKaVT_gD5WmlHRbC-PCpiwGPx/items/012VWERI4JFIU56LICZNBZA4MYHF6Z4AKJ"
                    sourceLastModified: "2021-05-29T21:00:00Z"
                    permissions:
                      - read
                      - write
                  links:
                    status: "https://admin.hlx.page/status/adobe/blog/main/blog"
                    preview: "https://admin.hlx.page/preview/adobe/blog/main/blog"
                    live: "https://admin.hlx.page/live/adobe/blog/main/blog"
                    code: "https://admin.hlx.page/code/adobe/blog/main/blog"
      '400':
        $ref: "./responses.yaml#/400"
      '401':
        $ref: "./responses.yaml#/401"
      '403':
        $ref: "./responses.yaml#/403"
      '404':
        $ref: "./responses.yaml#/404"
      '500':
        $ref: "./responses.yaml#/500"

  delete:
    operationId: deletePreview
    tags:
      - preview
    summary: Delete preview
    description: >
      Deletes a preview resource from the `preview` partition in the content-bus..
    security:
      - {}
      - AuthCookie:
          - preview:read
          - preview:delete
    parameters:
      - $ref: "./parameters.yaml#/ownerParam"
      - $ref: "./parameters.yaml#/repoParam"
      - $ref: "./parameters.yaml#/refParam"
      - $ref: "./parameters.yaml#/pathParam"
    responses:
      '204':
        description: Resource deleted.
      '400':
        $ref: "./responses.yaml#/400"
      '401':
        $ref: "./responses.yaml#/401"
      '403':
        $ref: "./responses.yaml#/403"
      '404':
        $ref: "./responses.yaml#/404"
      '500':
        $ref: "./responses.yaml#/500"
